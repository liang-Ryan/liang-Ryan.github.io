"use strict";(self["webpackChunksmart_shopping"]=self["webpackChunksmart_shopping"]||[]).push([[266],{4266:function(t,s,e){e.r(s),e.d(s,{default:function(){return f}});e(4114);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"detail"},[s("van-nav-bar",{attrs:{fixed:"",title:"商品详情页","left-arrow":""},on:{"click-left":function(s){return t.$router.go(-1)}}}),s("van-swipe",{attrs:{autoplay:3e3},on:{change:t.onChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[s("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current)+" / "+t._s(t.images.length))])]},proxy:!0}])},t._l(t.images,(function(t){return s("van-swipe-item",{key:t.file_id},[s("img",{attrs:{src:t.external_url}})])})),1),s("div",{staticClass:"info"},[s("div",{staticClass:"title"},[s("div",{staticClass:"price"},[s("span",{staticClass:"now"},[t._v("￥"+t._s(t.detail.goods_price_min))]),s("span",{staticClass:"oldprice"},[t._v("￥"+t._s(t.detail.goods_price_max))])]),s("div",{staticClass:"sellcount"},[t._v("已售"+t._s(t.detail.goods_sales)+"件")])]),s("div",{staticClass:"msg text-ellipsis-2"},[t._v(t._s(t.detail.goods_name))]),s("div",{staticClass:"service",on:{click:function(s){t.showServiceSheet=!0}}},[s("div",{staticClass:"left-words"},t._l(t.serviceList,(function(e){return s("span",{key:e.service_id},[s("van-icon",{attrs:{name:"passed"}}),t._v(t._s(e.name)+" ")],1)})),0),s("div",{staticClass:"right-icon"},[s("van-icon",{attrs:{name:"arrow"}})],1)])]),s("van-action-sheet",{staticClass:"service-sheet",attrs:{title:"商品保障服务"},model:{value:t.showServiceSheet,callback:function(s){t.showServiceSheet=s},expression:"showServiceSheet"}},t._l(t.serviceList,(function(e){return s("div",{key:e.service_id},[s("van-icon",{attrs:{name:"passed"}}),t._v(t._s(e.name)+" ")],1)})),0),s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-title"},[s("div",{staticClass:"left"},[t._v("商品评价 ("+t._s(t.commentSum)+"条)")]),s("div",{staticClass:"right",on:{click:function(s){return t.showCommentList(-1,1)}}},[t._v("查看更多 "),s("van-icon",{attrs:{name:"arrow"}})],1)]),s("div",{staticClass:"comment-list"},t._l(t.firstThreeComment,(function(e){return s("div",{key:e.comment_id,staticClass:"comment-item"},[s("div",{staticClass:"top"},[s("img",{attrs:{src:e.user.avatar_url||t.defaultImg,alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(e.user.nick_name))]),s("van-rate",{attrs:{size:16,value:e.score/6,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1),s("div",{staticClass:"content"},[t._v(t._s(e.content))]),s("div",{staticClass:"time"},[t._v(t._s(e.create_time))])])})),0)]),s("van-action-sheet",{staticClass:"comment-sheet",attrs:{title:"商品评价"},model:{value:t.showCommentSheet,callback:function(s){t.showCommentSheet=s},expression:"showCommentSheet"}},[s("div",{staticClass:"comment-list"},t._l(t.commentList,(function(e){return s("div",{key:e.comment_id,staticClass:"comment-item"},[s("div",{staticClass:"top"},[s("img",{attrs:{src:e.user.avatar_url||t.defaultImg,alt:""}}),s("div",{staticClass:"name"},[t._v(t._s(e.user.nick_name))]),s("van-rate",{attrs:{size:16,value:e.score/6,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1),s("div",{staticClass:"content"},[t._v(t._s(e.content))]),s("div",{staticClass:"time"},[t._v(t._s(e.create_time))])])})),0)]),s("div",{staticClass:"content",domProps:{innerHTML:t._s(t.detail.content)}}),s("div",{staticClass:"footer"},[s("div",{staticClass:"icon-home",on:{click:function(s){return t.$router.push("/home")}}},[s("van-icon",{attrs:{name:"wap-home-o"}}),s("span",[t._v("首页")])],1),s("div",{staticClass:"icon-cart",on:{click:function(s){return t.$router.push("/cart")}}},[s("van-icon",{attrs:{name:"shopping-cart-o",badge:t.cartTotal>0?t.cartTotal:""}}),s("span",[t._v("购物车")])],1),s("div",{staticClass:"btn-add",on:{click:function(s){return t.popSheet("cart")}}},[t._v("加入购物车")]),s("div",{staticClass:"btn-buy",on:{click:function(s){return t.popSheet("pay")}}},[t._v("立刻购买")])]),s("van-action-sheet",{attrs:{title:t.paySheetTitle},model:{value:t.showPaySheet,callback:function(s){t.showPaySheet=s},expression:"showPaySheet"}},[s("div",{staticClass:"action-sheet"},[s("div",{staticClass:"sheet-content"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:t.detail.goods_image,alt:""}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"price"},[s("span",{staticClass:"price-icon"},[t._v("￥")]),s("span",[t._v(t._s(t.detail.goods_price_min))])]),s("div",[s("span",[t._v("库存")]),s("span",[t._v(t._s(t.detail.stock_total))])])])]),s("div",{staticClass:"num-box"},[s("span",[t._v("数量")]),s("counter",{model:{value:t.count,callback:function(s){t.count=s},expression:"count"}})],1),t.detail.stock_total>0?s("div",["加入购物车"===t.paySheetTitle?s("div",{staticClass:"btn-cart",on:{click:function(s){return t.order("cart")}}},[t._v("加入购物车")]):s("div",{staticClass:"btn-pay",on:{click:function(s){return t.order("pay")}}},[t._v("立刻购买")])]):s("div",{staticClass:"btn-none"},[t._v("该商品已被抢完")])])])],1)},a=[],o=e(7767),n=e(7364),c=e(5720);const r=t=>c.A.get("/goods/detail",{params:{goodsId:t}}),l=t=>c.A.get("/goods.service/list",{params:{goodsId:t}}),d=(t,s)=>c.A.get("/comment/listRows",{params:{goodsId:t,limit:s}}),m=(t,s,e)=>c.A.get("/comment/list",{params:{scoreType:t,goodsId:s,page:e}});var h=e(9652),v=(e(2427),e(5240)),u={methods:{loginCheck(){return!!this.$store.getters.token||(v.A.confirm({message:"请登录后再进行操作",confirmButtonText:"去登录",cancelButtonText:"再逛逛"}).then((()=>{this.$router.push("/login")})).catch((()=>{})),!1)}}},_={name:"DetailIndex",components:{counter:n.A},mixins:[u],created(){this.getDetail(),this.getService(),this.getComment(3),this.getCart()},data(){return{detail:{},images:[],skuList:[],serviceList:[],commentSum:"",firstThreeComment:[],commentList:[],defaultImg:o,current:1,count:1,showServiceSheet:!1,showCommentSheet:!1,showPaySheet:!1,paySheetTitle:"加入购物车",cartTotal:""}},computed:{goods_id(){return this.$route.params.id}},methods:{async getDetail(){const{data:{detail:t}}=await r(this.goods_id);this.detail=t,this.images=t.goods_images,this.skuList=t.skuList},async getService(){const{data:{list:t}}=await l(this.goods_id);this.serviceList=t},async getComment(t){const{data:{total:s,list:e}}=await d(this.goods_id,t);this.firstThreeComment=e,this.commentSum=s},async showCommentList(t,s){const{data:{list:{data:e}}}=await m(t,this.goods_id,s);this.commentList=e,this.showCommentSheet=!0},onChange(){this.current>=4?this.current=1:this.current++},popSheet(t){"cart"===t?this.paySheetTitle="加入购物车":"pay"===t&&(this.paySheetTitle="立刻购买"),this.showPaySheet=!0},async order(t){if(this.loginCheck())if("cart"===t){const{data:t,message:s}=await(0,h.S6)(this.goods_id,this.count,this.skuList[0].goods_sku_id);this.cartTotal=t.cartTotal,this.$toast(s),this.showPaySheet=!1}else"pay"===t?this.$router.push({path:"/pay",query:{mode:"buyNow",obj:{goodsId:this.goods_id,goodsNum:this.count,goodsSkuId:this.skuList[0].goods_sku_id}}}):console.log("type值错误")},async getCart(){const{data:{cartTotal:t}}=await(0,h.YB)();this.cartTotal=t}}},p=_,g=e(1656),C=(0,g.A)(p,i,a,!1,null,"c30851b0",null),f=C.exports}}]);
//# sourceMappingURL=266.ac4ee086.js.map